{"componentChunkName":"component---src-templates-blog-js","path":"/blog/nextjs-graphql-server","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Create Graphql server in Next.js","date":"2020-21-11"},"html":"<p>สวัสดีครับ วันนี้จะมาแนะนำการสร้าง Graphql server ใน Next.js project กัน หลายคนอาจจะสงสัยนะครับว่า อ้าว Next.js เป็น React Framework ไม่ใช่เหรอ แล้วมันเอามาทำ Graphql server ได้ยังไง ตอนแรกผมก็งงๆ แบบนี้เหมือนกัน แต่ลองไปค้นคว้าเพิ่มเติมดูพบว่า ตั้งแต่ Next.js version 9 เป็นต้นมา เราสามารถสร้าง api route ได้เองใน project ของเราเลย ซึ่งก็สามารถสร้างได้ทั้ง REST api ปกติ หรือว่า Graphql api ก็ได้เช่นกัน ทีนี้มีขั้นตอนการทำยังไง เรามาเริ่มกันเลยครับ</p>\n<h2>Create Next.js Project</h2>\n<p>สร้าง project ขึ้นมาใหม่โดยใช้คำสั่งข้างล่างนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk1\">npx create-next-app nextjs-graphql-server-example</span></span></code></pre>\n<p>จากนั้นก็เข้าไปที่ project directory แล้วก็ให้มัน run โดยคำสั่ง</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk7\">cd</span><span class=\"mtk1\"> nextjs-graphql-server-example</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">yarn dev</span></span></code></pre>\n<p>แล้วไปที่ <code>http://localhost:3000</code> ก็จะเห็นหน้าตาแบบรูปข้างล่าง</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.80851063829788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVQ4y42UTW+CQBCG/f8Xj72beGkTE21NmzQ99oyNgokCmhT5sAJaUQgfvnXGrlkoWjeZsOzMzvA+M6FxOBxAi55FUeDaErHyKqT7tBpyol6vh2aziVarhW63i3a7jU6ng/7TI15e33A/KHD3nuFZy/EwyNBXM6zjSkL5xfd9GIaB8XiM4XAITdPY6Ew3TNhhio/PBPNVBsXKMQ8K5EVNwqqczWYDz/PYlsslHNdFEPj48hysVy6i71AG8XtXkiwzJKN9lVeen3zETNgprsy4cQm2KFBNXj2vxnDCNE0xmUwwnU6Z32w24zO5WBiGzHK3212dAE6YZRknHI1G3AyR1D2yI59omKqq58KO47Dfsizs9/uy5DzPuQEiiPZBEPC5GKkoithPvsVige12y35SImSXmnJJRl2D6vx/JNO8kVzbtmvZ0JcpisLPmxgSNzJipOs6G0kTkokhMaYY0zTZiB9hSJKkzJAuETuZESUgRqIydVcw5mE/7uM4Ls3umeEtHP/7aYiYH66LNSGqgto9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"next start\"\n        title=\"next start\"\n        src=\"/static/b65dd8a9448abff6ff2b789aee48c51b/1d69c/next_start.png\"\n        srcset=\"/static/b65dd8a9448abff6ff2b789aee48c51b/4dcb9/next_start.png 188w,\n/static/b65dd8a9448abff6ff2b789aee48c51b/5ff7e/next_start.png 375w,\n/static/b65dd8a9448abff6ff2b789aee48c51b/1d69c/next_start.png 750w,\n/static/b65dd8a9448abff6ff2b789aee48c51b/78797/next_start.png 1125w,\n/static/b65dd8a9448abff6ff2b789aee48c51b/aa440/next_start.png 1500w,\n/static/b65dd8a9448abff6ff2b789aee48c51b/92bb4/next_start.png 1824w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2>Next.js API Route intruduction</h2>\n<p>ทีนี้เราก็เปิด project ขึ้นมาด้วย text editor ผมใช้ vscode นะครับ เราก็จะเห็นโครงสร้าง folder ต่างๆ ประมาณนี้</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.446808510638306%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVQoz6WSyW7CQBBE/RuYTcJ4A8djj8ezYY9ZIqGcc87/f0almQiSKIuEOZRas+ipuquDt9cXqIOBVhaNaCFaCSFIrYKUGk0jwH9RzRsobeCGPXZdj753MHaHYH84oWY1OrqsWIUkSZHnua9RFGE2m2E6DUnTHwrDEJPJ5KbLORBNA845hqGHtR25a72rsmRYr2Msl0ssFos/9fn+UYOWWiyLHOejBas40jTDahWRu7UHXj7O5/N/oV8VSKmwyTNYw1DX3IPiOPG6OrwLqJRGlsVQpqQQDEG+A+92qJVCVhLs+QT2VN5afQAokRUMwp1htUZV1T7hC2wU0FqLDQGclOhol7bb4rGWnXNIKNmWZjm4geaZ34IZBTRGIyVIuin8Ql/nNxb4Dg5MPHeZmRBhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"project structure\"\n        title=\"project structure\"\n        src=\"/static/8cd4283a3c8702a6bee6312fb135c938/1d69c/project_structure.png\"\n        srcset=\"/static/8cd4283a3c8702a6bee6312fb135c938/4dcb9/project_structure.png 188w,\n/static/8cd4283a3c8702a6bee6312fb135c938/5ff7e/project_structure.png 375w,\n/static/8cd4283a3c8702a6bee6312fb135c938/1d69c/project_structure.png 750w,\n/static/8cd4283a3c8702a6bee6312fb135c938/78797/project_structure.png 1125w,\n/static/8cd4283a3c8702a6bee6312fb135c938/aa440/project_structure.png 1500w,\n/static/8cd4283a3c8702a6bee6312fb135c938/adef7/project_structure.png 1716w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>จะเห็นได้ว่ามี folder <code>pages/api</code> อยู่ แล้วข้างในมีไฟล์ที่ชื่อว่า <code>hello.js</code> ถ้าลองเปิดดู จะเห็น code แบบนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk3 mtki\">// pages/api/hello.js</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk3 mtki\">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk8\">default</span><span class=\"mtk1\"> (req, res) </span><span class=\"mtk13 mtkb\">=&gt;</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk7\">res</span><span class=\"mtk1\">.</span><span class=\"mtk7\">statusCode</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">200</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk7\">res</span><span class=\"mtk1\">.</span><span class=\"mtk7\">json</span><span class=\"mtk1\">({ name: </span><span class=\"mtk11\">&#39;John Doe&#39;</span><span class=\"mtk1\"> })</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>ถ้าใครเคยพัฒนา application ด้วย node.js/express มาก่อน ก็ร้องอ๋อเลยทีเดียว เพราะมันคือการสร้าง express handler นั่นเอง จาก <a href=\"https://nextjs.org/docs/api-routes/introduction\">document</a> เค้าก็จะบอกว่า ถ้าเราสร้างไฟล์ไว้ข้างใน <code>pages/api</code> มันก็จะนำชื่อไฟล์มาสร้างเป็น api route ให้เราเลย ถ้าอยากรู้ว่าหน้าตา response เป็นอย่างไร ก็เข้าไปที่ <code>http://localhost:3000/api/hello</code></p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;John Doe&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<h2>Create Graphql server</h2>\n<p>ต่อไปก็เป็นการสร้าง Graphql Server นะครับ ขั้นตอนนี้หวังว่าทุกคน พอจะมี basic graphql คร่าวๆ แล้วนะครับ เข้าใจการสร้าง type, Resolvers function อะไรพวกนี้ ก่อนอื่นก็ install dependencies เหล่านี้ก่อนครับ</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"bash\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk1\">npm install --save apollo-server-micro graphql swr axios</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">or</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">yarn add apollo-server-micro graphql swr axios</span></span></code></pre>\n<p>โดยที่</p>\n<ul>\n<li><code>apollo-server-micro</code>, <code>graphql</code> สำหรับสร้าง Graphql server</li>\n<li><code>swr</code>, <code>axios</code> สำหรับ fetch data จาก graphql</li>\n</ul>\n<p>ทีนี้สร้างไฟล์ <code>graphql.js</code> ข้างใน <code>pages/api</code> และสร้าง Graphql server แบบนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk3 mtki\">// graphql.js</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk7\">ApolloServer</span><span class=\"mtk1\">, </span><span class=\"mtk7\">gql</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;apollo-server-micro&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">typeDefs</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">gql</span><span class=\"mtk11\">`</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  type Query {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    users: [User!]!</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  }</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  type User {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    firstname: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    lastname: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    age: Int</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    occupation: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">`</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">resolvers</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  Query: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk13 mtkb\">async</span><span class=\"mtk1\"> </span><span class=\"mtk7\">users</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> [</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          firstname: </span><span class=\"mtk11\">&quot;Teerapat&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          lastname: </span><span class=\"mtk11\">&quot;Prommarak&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          age: </span><span class=\"mtk6\">34</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          occupation: </span><span class=\"mtk11\">&#39;Software Engineer&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          firstname: </span><span class=\"mtk11\">&quot;Mesut&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          lastname: </span><span class=\"mtk11\">&quot;Ozil&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          age: </span><span class=\"mtk6\">31</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          occupation: </span><span class=\"mtk11\">&#39;Professional Footballer&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          firstname: </span><span class=\"mtk11\">&quot;Bill&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          lastname: </span><span class=\"mtk11\">&quot;Gate&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          age: </span><span class=\"mtk6\">65</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">          occupation: </span><span class=\"mtk11\">&#39;Entrepreneur&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      ]</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">};</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">apolloServer</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">new</span><span class=\"mtk1\"> </span><span class=\"mtk7\">ApolloServer</span><span class=\"mtk1\">({ </span><span class=\"mtk7\">typeDefs</span><span class=\"mtk1\">, </span><span class=\"mtk7\">resolvers</span><span class=\"mtk1\"> });</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  api: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    bodyParser: </span><span class=\"mtk5\">false</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">};</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk8\">default</span><span class=\"mtk1\"> </span><span class=\"mtk7\">apolloServer</span><span class=\"mtk1\">.</span><span class=\"mtk7\">createHandler</span><span class=\"mtk1\">({ path: </span><span class=\"mtk11\">&#39;/api/graphql&#39;</span><span class=\"mtk1\"> });</span></span></code></pre>\n<p>จากนั้นให้เข้าไปที่ <code>http://localhost:3000/api/graphql</code> ก็จะเห็น graphql playground ทีนี้ลอง query เล่นๆ ดูครับ</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk7\">query</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk7\">users</span><span class=\"mtk1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">firstname</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">lastname</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">age</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">occupation</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>เราก็จะได้ query result ออกมาแบบนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"json\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">&quot;data&quot;</span><span class=\"mtk1\">: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;users&quot;</span><span class=\"mtk1\">: [</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Teerapat&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;lastname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Prommarak&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">34</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;occupation&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Software Engineer&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Mesut&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;lastname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Ozil&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">31</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;occupation&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Professional Footballer&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Bill&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;lastname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Gate&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">65</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;occupation&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Entrepreneur&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    ]</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>ความสะดวกของ graphql query ก็คือในกรณีที่มันมี field ที่เราไม่ต้องการ เราก็ไม่ต้องเลือกมัน อย่างเช่น ถ้าผมต้องการแค่ firstname และ age ผมก็เขียน query ออกมาแบบนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk7\">query</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk7\">users</span><span class=\"mtk1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">firstname</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">age</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>response ที่ได้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"json\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">&quot;data&quot;</span><span class=\"mtk1\">: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;users&quot;</span><span class=\"mtk1\">: [</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Teerapat&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">34</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Mesut&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">31</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;firstname&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk11\">&quot;Bill&quot;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">&quot;age&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk6\">65</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    ]</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<h2>Working with existion API</h2>\n<p>คราวนี้ผมจะเปลี่ยนจาก mock data ข้างบนมาใช้ <a href=\"https://punkapi.com/documentation/v2\">brewdog punk api</a> ซึ่งผมต้องทำการแก้ไข <code>typeDefs</code> และ <code>query resolver</code> ก่อน โดยแก้ให้เป็นแบบนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"javascript\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk7\">ApolloServer</span><span class=\"mtk1\">, </span><span class=\"mtk7\">gql</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;apollo-server-micro&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">axios</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;axios&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">typeDefs</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">gql</span><span class=\"mtk11\">`</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  type Query {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    beers: [Beer!]!</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  type Beer {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    id: Int</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    name: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    tagline: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    first_brewed: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    description: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    image_url: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    abv: Float</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    brewers_tips: String</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">`</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">resolvers</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  Query: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk13 mtkb\">async</span><span class=\"mtk1\"> </span><span class=\"mtk7\">beers</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk8\">try</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">res</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">await</span><span class=\"mtk1\"> </span><span class=\"mtk7\">axios</span><span class=\"mtk1\">.</span><span class=\"mtk7\">get</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;https://api.punkapi.com/v2/beers&#39;</span><span class=\"mtk1\">);</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">beer</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">res</span><span class=\"mtk1\">.</span><span class=\"mtk7\">data</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">beer</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      } </span><span class=\"mtk8\">catch</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">error</span><span class=\"mtk1\">) {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk8\">throw</span><span class=\"mtk1\"> </span><span class=\"mtk7\">error</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">};</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">apolloServer</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">new</span><span class=\"mtk1\"> </span><span class=\"mtk7\">ApolloServer</span><span class=\"mtk1\">({ </span><span class=\"mtk7\">typeDefs</span><span class=\"mtk1\">, </span><span class=\"mtk7\">resolvers</span><span class=\"mtk1\"> });</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">config</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  api: {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    bodyParser: </span><span class=\"mtk5\">false</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">};</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk8\">default</span><span class=\"mtk1\"> </span><span class=\"mtk7\">apolloServer</span><span class=\"mtk1\">.</span><span class=\"mtk7\">createHandler</span><span class=\"mtk1\">({ path: </span><span class=\"mtk11\">&#39;/api/graphql&#39;</span><span class=\"mtk1\"> });</span></span></code></pre>\n<p>ลองไป query ดูใน graphql playground ครับ</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.63829787234043%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABbElEQVQoz5WSy0+DQBjEuZnUpKUaYamJUPuwVN4U+qRttPboxavx6NH//zZ+y+5aikmrh1+Ghd3JN7No9uwVzM1guHNc90LojofmbR8N00HDsHHJ9R9o5ngGY5TDdHMYDxPccIYp7oJF+U7vJbjqE4OUSM6i6b0I+jBB0/ZKWo6PC2uI988v7N4+yDRDJyxgPi7+hNbuBtBHZDoI0ZKG3JhP2/FXsDjhFqa3hDGel9UcaQ1NJwPdjUtaXb80LSfthj+bWPwCljwRK5gRES6FBksxmSd5nIsJ1VTNyoTt+0hsooPWZFfC0jXYpBBk/JlIixJlrikDrgq+1rkhbWA+baTYvyIT1e7UWhg60tCuGarI0TNYsKZpZVTvYFLv8vSE/CD1ZWV7WNM92HQLNtuQboTyqCoy79c/FZkuhffCctkbV95bVacVnRTnOpSGqvysZpzJC8kP30zq+2xkFtOhhKLGm+NfRj3HUkNxy99UzVrBrLWNVgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"beers\"\n        title=\"beers\"\n        src=\"/static/43805d86217aef81bb01d8a6bfa23d2d/1d69c/beers_playground.png\"\n        srcset=\"/static/43805d86217aef81bb01d8a6bfa23d2d/4dcb9/beers_playground.png 188w,\n/static/43805d86217aef81bb01d8a6bfa23d2d/5ff7e/beers_playground.png 375w,\n/static/43805d86217aef81bb01d8a6bfa23d2d/1d69c/beers_playground.png 750w,\n/static/43805d86217aef81bb01d8a6bfa23d2d/78797/beers_playground.png 1125w,\n/static/43805d86217aef81bb01d8a6bfa23d2d/aa440/beers_playground.png 1500w,\n/static/43805d86217aef81bb01d8a6bfa23d2d/fb458/beers_playground.png 2362w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2>Fetch data in client side</h2>\n<p>หลังจากที่ Server ของเราเสร็จเป็นที่เรียบร้อยแล้ว ทีนี้ลองมาทำให้มันแสดงผลที่ฝั่ง frontend ดูบ้างครับ ผมจะให้ library <code>swr</code> เป็นตัวช่วย fetch data จาก graphql server นะครับ เบื้องต้น <code>swr</code> เป็น react hook ที่ช่วยอำนวยความสะดวกเราในการดึงข้อมูลจาก server โดยที่เราไม่ต้องใช้ <code>React.useEffect</code> เราสามรถใช้ <code>swr</code> กับ rest api ปกติก็ได้ ไม่จำเป็นว่าต้องเป็น graphql server ซึ่ง <code>swr</code> เองมีตัวช่วยเรื่อง <code>caching</code> หรือ <code>pagination</code> ด้วย จริงมันมีอะไรมากกว่านั้นอีก สามารถศึกษาเพิ่มเติมได้ที่ <a href=\"https://swr.vercel.app/\">SWR</a> ครับ</p>\n<p>คราวนี้เปิดไฟล์ <code>index.js</code> ขึ้นมาครับ ลบทุกอย่าง แต่ให้เหลือประมาณนี้</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"jsx\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">styles</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;../styles/Home.module.css&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">useSWR</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;swr&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk8\">default</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Home</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> (</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\"> </span><span class=\"mtk3\">className</span><span class=\"mtk8\">=</span><span class=\"mtk9\">{</span><span class=\"mtk7\">styles</span><span class=\"mtk1\">.</span><span class=\"mtk7\">container</span><span class=\"mtk9\">}</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk3\">&lt;</span><span class=\"mtk7\">h1</span><span class=\"mtk3\">&gt;</span><span class=\"mtk1\">PUNK IPA</span><span class=\"mtk3\">&lt;/</span><span class=\"mtk7\">h1</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  );</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>ปกติแล้ว <code>useSWR</code> จะรับ 2 parameters เพื่อดึงข้อมูลมาจาก graphql server</p>\n<ul>\n<li><code>query</code></li>\n<li><code>fetchData function</code></li>\n</ul>\n<p>โดยที่เขียน <code>query</code> และ <code>fetchData function</code> แบบนี้ จากนั้นลอง <code>console.log(data)</code> ออกมาดูครับ</p>\n<pre class=\"grvsc-container solarized-light\" data-language=\"jsx\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">styles</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;../styles/Home.module.css&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">useSWR</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;swr&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">import</span><span class=\"mtk1\"> </span><span class=\"mtk7\">axios</span><span class=\"mtk1\"> </span><span class=\"mtk8\">from</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;axios&#39;</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">fetchBeer</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">async</span><span class=\"mtk1\"> query </span><span class=\"mtk13 mtkb\">=&gt;</span><span class=\"mtk1\"> {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> </span><span class=\"mtk7\">response</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk8\">await</span><span class=\"mtk1\"> </span><span class=\"mtk7\">axios</span><span class=\"mtk1\">({</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    method: </span><span class=\"mtk11\">&#39;POST&#39;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    url: </span><span class=\"mtk11\">&#39;/api/graphql&#39;</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    data: JSON.</span><span class=\"mtk7\">stringify</span><span class=\"mtk1\">({ </span><span class=\"mtk7\">query</span><span class=\"mtk1\"> }),</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  });</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">response</span><span class=\"mtk1\">.</span><span class=\"mtk7\">data</span><span class=\"mtk1\">;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">};</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk8\">export</span><span class=\"mtk1\"> </span><span class=\"mtk8\">default</span><span class=\"mtk1\"> </span><span class=\"mtk13 mtkb\">function</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Home</span><span class=\"mtk1\">() {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk13 mtkb\">const</span><span class=\"mtk1\"> { </span><span class=\"mtk7\">data</span><span class=\"mtk1\">, </span><span class=\"mtk7\">error</span><span class=\"mtk1\"> } </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">useSWR</span><span class=\"mtk1\">(</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk11\">`</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">    query {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">      beers {</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        id</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        name</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        tagline</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        abv</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        description</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">        image_url</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">      }</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk11\">  }`</span><span class=\"mtk1\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">fetchBeer</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  );</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">console</span><span class=\"mtk1\">.</span><span class=\"mtk7\">log</span><span class=\"mtk1\">(</span><span class=\"mtk7\">data</span><span class=\"mtk1\">);</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  </span><span class=\"mtk8\">return</span><span class=\"mtk1\"> (</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;</span><span class=\"mtk7\">div</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk3\">&lt;</span><span class=\"mtk7\">h1</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk3\">className</span><span class=\"mtk8\">=</span><span class=\"mtk11\">&#39;text-5xl&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        </span><span class=\"mtk3\">style</span><span class=\"mtk8\">=</span><span class=\"mtk9\">{</span><span class=\"mtk1\">{ textAlign: </span><span class=\"mtk11\">&#39;center&#39;</span><span class=\"mtk1\">, paddingTop: </span><span class=\"mtk11\">&#39;3rem&#39;</span><span class=\"mtk1\"> }</span><span class=\"mtk9\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">        PUNK IPA</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">      </span><span class=\"mtk3\">&lt;/</span><span class=\"mtk7\">h1</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk3\">&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">  );</span></span>\n<span class=\"grvsc-line\"><span class=\"mtk1\">}</span></span></code></pre>\n<p>เราก็จะได้ข้อมูลกลับมาแบบนี้</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.7872340425532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4ElEQVQ4y5WU65KjIBCFff/Xy7/UTDLGKyqKgDfUnD2QzG6yWzWbYHXJ9esD3RCJqkLxFUPKBqrvIDsFayyU6tHzP6oWXddBs277Hp3iuB2gtEbHtuo1Ws41okTMedG+78C24alcr+zacBtbYbi4rmu0NFE1KGmh3d6cyUaiqilISkRXLvbFTzgcDjgejxin6c69jc3zEsaNtVjcimEYqNLALQvWdQ3mnfZU/Bs4jiOEEMGrn/ANDMZPSy7oDGZCfirRo5LnXV+foJvbYOoBo56xUeFqzM2obDU69HmL/l74bf9CAVNYDHULp3us3N5GYADdj8hPin6S/+hgWzeoisHJBYYyhytL2FZi8UCqXOjA0cFrQH7OB6aSKMsGQ5pgPH1CJRe0aRrqhjZcLq8rdItDI1oURY2RIJVlkEVBSByAE/s00+kthSLzOaigA+SEtmJWJAkm1sfzGROz5C1glUmImjcoiTGdT6h4yxS37IFz/AXN+tvAoDC9YIxjRr2AIchmKc8zgY6T14HLxC2nBIo/wJbA8fMDlvU+z3mu+RsKGZQqa1E3BrbIGJiED4KA9n8faQbJ5O8AZ4e+MhBMm2mwuDoHR9toOxN7v9/r/wJ9Wbc9AN3kwqPgex8v62P7F6On22F8E8eYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fetch data\"\n        title=\"fetch data\"\n        src=\"/static/e68b327acb43c9730aedbd918d9b694d/1d69c/fetchData.png\"\n        srcset=\"/static/e68b327acb43c9730aedbd918d9b694d/4dcb9/fetchData.png 188w,\n/static/e68b327acb43c9730aedbd918d9b694d/5ff7e/fetchData.png 375w,\n/static/e68b327acb43c9730aedbd918d9b694d/1d69c/fetchData.png 750w,\n/static/e68b327acb43c9730aedbd918d9b694d/78797/fetchData.png 1125w,\n/static/e68b327acb43c9730aedbd918d9b694d/aa440/fetchData.png 1500w,\n/static/e68b327acb43c9730aedbd918d9b694d/49853/fetchData.png 2224w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>จากนั้นใครจะ render data ยังไง หรือจะ styling ยังไง อันนี้แล้วความชอบของแต่ละคนเลยนะครับ ผมเองมีตัวอย่างที่ทำเสร็จแล้ว ลองเข้าไปดูกันได้ที่ <a href=\"https://nextjs-graphql-omega.vercel.app/\">Brewdog PUNK IPA</a> (ปล. ไม่สวยเลย ขออภัย 555555)</p>\n<p>หวังว่าจะมีประโยชน์สำหรับใครที่กำลังศึกษาด้านนี้อยู่นะครับ โดยส่วนตัวผมค่อนข้างชอบ tools, library หรือ framework ที่ทีม developers ของ Next.js ทำออกมามาก มี product ดีๆ หลายตัวเลยทำให้เราสามารถสร้างหรือทดลองทำอะไรใหม่ๆ แล้วนำเสนอกับคนอื่นๆ ได้เร็วขึ้น สำหรับโพสต์นี้ ก็ขอจบลงเพียงเท่านี้นะครับ Happy Coding :)</p>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://nextjs.org/docs/api-routes/introduction\">Next.js API Routes</a></li>\n<li><a href=\"https://www.smashingmagazine.com/2020/10/graphql-server-next-javascript-api-routes/\">How To Build A GraphQL Server Using Next.js API Routes</a></li>\n<li><a href=\"https://swr.vercel.app/\">SWR</a></li>\n<li><a href=\"https://github.com/xeusteerapat/nextjs-graphql\">Github Repo</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n  }\n  \n  .grvsc-code {\n    display: inline-block;\n    min-width: 100%;\n  }\n  \n  .grvsc-line {\n    display: inline-block;\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-line-highlighted {\n    background-color: var(--grvsc-line-highlighted-background-color, transparent);\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);\n  }\n  \n  .solarized-light { background-color: #FDF6E3; }\n  .solarized-light .mtkb { font-weight: bold; }\n  .solarized-light .mtki { font-style: italic; }\n  .solarized-light .mtk1 { color: #657B83; }\n  .solarized-light .mtk7 { color: #268BD2; }\n  .solarized-light .mtk3 { color: #93A1A1; }\n  .solarized-light .mtk8 { color: #859900; }\n  .solarized-light .mtk13 { color: #073642; }\n  .solarized-light .mtk6 { color: #D33682; }\n  .solarized-light .mtk11 { color: #2AA198; }\n  .solarized-light .mtk5 { color: #B58900; }\n  .solarized-light .mtk9 { color: #D30102; }\n</style>"}},"pageContext":{"slug":"nextjs-graphql-server"}}}